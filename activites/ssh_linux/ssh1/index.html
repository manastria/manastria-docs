<!doctype html><html lang=fr class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=Activités><link rel=prev href=../../..><link href=../../../about/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.4.14"><title>SSH - Activités</title><link rel=stylesheet href=../../../assets/stylesheets/main.fad675c6.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.d62c99.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#configuration-dun-serveur-dhcp-multi-vlan-avec-relais-dhcp-une-approche-pratique class=md-skip> Aller au contenu </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=En-tête> <a href=../../.. title=Activités class="md-header__button md-logo" aria-label=Activités data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Activités </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SSH </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Rechercher placeholder=Rechercher autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Recherche> <button type=reset class="md-search__icon md-icon" title=Effacer aria-label=Effacer tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initialisation de la recherche </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/manastria/manastria-docs title="Aller au dépôt" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> manastria-docs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Onglets data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Accueil </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Activités </a> </li> <li class=md-tabs__item> <a href=../../../about/ class=md-tabs__link> À propos </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Activités class="md-nav__button md-logo" aria-label=Activités data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Activités </label> <div class=md-nav__source> <a href=https://github.com/manastria/manastria-docs title="Aller au dépôt" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> manastria-docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Accueil </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Activités </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Activités </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> SSH </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> SSH </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table des matières"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table des matières </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#contexte-et-objectifs-pedagogiques class=md-nav__link> <span class=md-ellipsis> Contexte et objectifs pédagogiques </span> </a> </li> <li class=md-nav__item> <a href=#phase-1-configuration-de-base-le-dhcp-dans-un-environnement-simple class=md-nav__link> <span class=md-ellipsis> Phase 1 : Configuration de base - Le DHCP dans un environnement simple </span> </a> <nav class=md-nav aria-label="Phase 1 : Configuration de base - Le DHCP dans un environnement simple"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#materiel-necessaire class=md-nav__link> <span class=md-ellipsis> Matériel nécessaire </span> </a> </li> <li class=md-nav__item> <a href=#synoptique-de-linfrastructure class=md-nav__link> <span class=md-ellipsis> Synoptique de l'infrastructure </span> </a> </li> <li class=md-nav__item> <a href=#mise-en-place-de-linfrastructure-initiale class=md-nav__link> <span class=md-ellipsis> Mise en place de l'infrastructure initiale </span> </a> </li> <li class=md-nav__item> <a href=#tests-de-validation class=md-nav__link> <span class=md-ellipsis> Tests de validation </span> </a> </li> <li class=md-nav__item> <a href=#resolution-des-problemes-courants class=md-nav__link> <span class=md-ellipsis> Résolution des problèmes courants </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phase-2-mise-en-place-de-la-segmentation-reseau-avec-router-on-a-stick class=md-nav__link> <span class=md-ellipsis> Phase 2 : Mise en place de la segmentation réseau avec Router-on-a-stick </span> </a> <nav class=md-nav aria-label="Phase 2 : Mise en place de la segmentation réseau avec Router-on-a-stick"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#materiel-supplementaire-necessaire class=md-nav__link> <span class=md-ellipsis> Matériel supplémentaire nécessaire </span> </a> </li> <li class=md-nav__item> <a href=#nouvelle-architecture-reseau class=md-nav__link> <span class=md-ellipsis> Nouvelle architecture réseau </span> </a> <nav class=md-nav aria-label="Nouvelle architecture réseau"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#topologie-physique class=md-nav__link> <span class=md-ellipsis> Topologie physique </span> </a> </li> <li class=md-nav__item> <a href=#topologie-logique class=md-nav__link> <span class=md-ellipsis> Topologie logique </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#etapes-de-configuration class=md-nav__link> <span class=md-ellipsis> Étapes de configuration </span> </a> </li> <li class=md-nav__item> <a href=#tests-de-validation-etape-par-etape class=md-nav__link> <span class=md-ellipsis> Tests de validation étape par étape </span> </a> </li> <li class=md-nav__item> <a href=#resolution-des-problemes-courants_1 class=md-nav__link> <span class=md-ellipsis> Résolution des problèmes courants </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phase-3-mise-en-place-du-relais-dhcp class=md-nav__link> <span class=md-ellipsis> Phase 3 : Mise en place du relais DHCP </span> </a> <nav class=md-nav aria-label="Phase 3 : Mise en place du relais DHCP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuration-du-relais-dhcp class=md-nav__link> <span class=md-ellipsis> Configuration du relais DHCP </span> </a> </li> <li class=md-nav__item> <a href=#tests-approfondis class=md-nav__link> <span class=md-ellipsis> Tests approfondis </span> </a> </li> <li class=md-nav__item> <a href=#comprendre-ce-qui-se-passe class=md-nav__link> <span class=md-ellipsis> Comprendre ce qui se passe </span> </a> </li> <li class=md-nav__item> <a href=#resolution-des-problemes-courants_2 class=md-nav__link> <span class=md-ellipsis> Résolution des problèmes courants </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> <span class=md-ellipsis> À propos </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/manastria/manastria-docs/edit/master/docs/activites/ssh_linux/ssh1.md title="Editer cette page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1 id=configuration-dun-serveur-dhcp-multi-vlan-avec-relais-dhcp-une-approche-pratique>Configuration d'un serveur DHCP multi-VLAN avec relais DHCP : Une approche pratique</h1> <h2 id=introduction>Introduction</h2> <p>Dans un réseau d'entreprise moderne, la gestion manuelle des adresses IP devient rapidement complexe et source d'erreurs. Imaginez devoir configurer individuellement les paramètres réseau de centaines d'ordinateurs ! C'est là qu'intervient le protocole DHCP (<em>Dynamic Host Configuration Protocol</em>), qui automatise cette tâche essentielle.</p> <p>Cette activité pratique vous guidera à travers la mise en place d'une infrastructure DHCP dans un environnement réseau segmenté. Vous allez progressivement construire une solution complète, en partant d'une configuration simple pour arriver à une architecture plus sophistiquée avec plusieurs VLANs.</p> <h2 id=contexte-et-objectifs-pedagogiques>Contexte et objectifs pédagogiques</h2> <p>Imaginons une petite entreprise qui souhaite séparer son réseau en deux segments distincts :</p> <ul> <li>Un VLAN 10 pour les services informatiques (où sera notre serveur DHCP)</li> <li>Un VLAN 20 pour les postes des employés</li> </ul> <p>Cette séparation pose un défi intéressant : comment permettre aux ordinateurs du VLAN 20 d'obtenir automatiquement leurs configurations réseau alors que le serveur DHCP se trouve dans un autre VLAN ? C'est là que la notion de relais DHCP prend tout son sens.</p> <h2 id=phase-1-configuration-de-base-le-dhcp-dans-un-environnement-simple>Phase 1 : Configuration de base - Le DHCP dans un environnement simple</h2> <h3 id=materiel-necessaire>Matériel nécessaire</h3> <ul> <li>1 switch Cisco 2960 (ou similaire)</li> <li>1 PC physique pour héberger la machine virtuelle serveur Debian 12</li> <li>1 PC client (physique ou virtuel, différent du PC serveur)</li> <li>Câbles réseau droits</li> </ul> <h3 id=synoptique-de-linfrastructure>Synoptique de l'infrastructure</h3> <p><img alt="Synoptique de l'infrastructure" src=../images/R%C3%A9seau%20E1.drawio.svg></p> <h3 id=mise-en-place-de-linfrastructure-initiale>Mise en place de l'infrastructure initiale</h3> <ol> <li><strong>Configuration du PC serveur</strong><ol> <li>Installez VirtualBox ou VMware sur votre PC physique</li> <li>Créez une machine virtuelle Debian 12 avec une interface réseau en mode Bridge</li> <li>Configurez l'adresse IP statique sur la VM Debian :<ol> <li>Adresse IP : 192.168.10.10</li> <li>Masque : 255.255.255.0</li> <li>Passerelle : pour l'instant, pas nécessaire</li> </ol> </li> </ol> </li> <li><strong>Configuration du switch</strong><ol> <li>Pour cette première phase, aucune configuration n'est nécessaire</li> <li>Laissez le switch dans sa configuration par défaut (tous les ports en VLAN 1)</li> <li>Connectez :<ol> <li>Le PC physique hébergeant la VM serveur sur le port Fa0/1</li> <li>Le PC client sur le port Fa0/2</li> </ol> </li> </ol> </li> <li><strong>Installation et configuration du serveur DHCP</strong><ol> <li>Utilisez votre fiche technique pour installer le package <code>isc-dhcp-server</code></li> <li>Configurez le serveur DHCP avec les paramètres suivants :<ol> <li>Plage d'adresses : <code>192.168.10.50</code> à <code>192.168.10.100</code></li> <li>Masque de sous-réseau : <code>255.255.255.0</code></li> <li>Passerelle : <code>192.168.10.1</code> (pour plus tard)</li> <li>Serveur DNS : <code>8.8.8.8</code></li> </ol> </li> </ol> </li> </ol> <h3 id=tests-de-validation>Tests de validation</h3> <p>Pour vérifier que votre configuration fonctionne correctement, suivez cette procédure de test pas à pas :</p> <ol> <li><strong>Sur le serveur Debian</strong></li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a># Vérifiez que le service DHCP est actif
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>sudo systemctl status isc-dhcp-server
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a># Vérifiez les logs DHCP pour d&#39;éventuelles erreurs
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>sudo tail -f /var/log/syslog | grep dhcp
</code></pre></div> <p>➜ Le service doit être "active (running)"</p> <p>➜ Les logs ne doivent pas montrer d'erreurs</p> <ol> <li> <p><strong>Sur le PC client</strong></p> <ol> <li> <p>Windows : <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>ipconfig /release
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>ipconfig /renew
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>ipconfig /all
</code></pre></div></p> </li> <li> <p>Linux : <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>sudo dhclient -r
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>sudo dhclient
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>ip a
</code></pre></div></p> </li> </ol> <p>➜ Vous devez observer :</p> <ol> <li>Une adresse IP dans la plage <code>192.168.10.50-100</code><ol> <li>Le masque <code>255.255.255.0</code></li> <li>La passerelle <code>192.168.10.1</code></li> <li>Le serveur DNS <code>8.8.8.8</code></li> </ol> </li> <li><strong>Tests de connectivité</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a># Depuis le client
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>ping 192.168.10.10  # Vers le serveur DHCP
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a># Depuis le serveur
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>ping [IP_obtenue_par_le_client]
</code></pre></div></li> </ol> <p>➜ Les pings doivent fonctionner dans les deux sens</p> </li> <li> <p><strong>Vérification des baux DHCP</strong></p> </li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a># Sur le serveur
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>cat /var/lib/dhcp/dhcpd.leases
</code></pre></div> <p>➜ Vous devez voir l'adresse MAC de votre client et l'IP qui lui a été attribuée</p> <h3 id=resolution-des-problemes-courants>Résolution des problèmes courants</h3> <ul> <li>Si le service ne démarre pas : vérifiez les logs avec <code>journalctl -xe</code></li> <li>Si le client n'obtient pas d'adresse :<ul> <li>Vérifiez la connexion physique (LEDs du switch)</li> <li>Assurez-vous que le pare-feu du serveur autorise DHCP</li> <li>Contrôlez que l'interface réseau est correctement déclarée dans <code>/etc/default/isc-dhcp-server</code></li> </ul> </li> </ul> <h2 id=phase-2-mise-en-place-de-la-segmentation-reseau-avec-router-on-a-stick>Phase 2 : Mise en place de la segmentation réseau avec Router-on-a-stick</h2> <p>Maintenant que notre serveur DHCP fonctionne dans un réseau simple, nous allons créer une infrastructure plus sophistiquée avec deux VLANs distincts. Cette configuration reflète mieux la réalité d'une entreprise où différents services doivent être séparés logiquement.</p> <h3 id=materiel-supplementaire-necessaire>Matériel supplémentaire nécessaire</h3> <ul> <li>1 routeur Cisco 2901 (ou similaire)</li> <li>1 câble console pour la configuration du routeur</li> <li>1 câble réseau supplémentaire pour connecter le switch au routeur</li> <li>Configurer la connexion SSH sur le routeur et le switch</li> </ul> <h3 id=nouvelle-architecture-reseau>Nouvelle architecture réseau</h3> <p>Pour cette phase, nous allons créer :</p> <ul> <li>VLAN 10 (Service informatique) : réseau <code>192.168.10.0/24</code></li> <li>VLAN 20 (Employés) : réseau <code>192.168.20.0/24</code></li> </ul> <h4 id=topologie-physique>Topologie physique</h4> <p><img alt="Topologie physique" src=../images/R%C3%A9seau%20E2.drawio.svg></p> <h4 id=topologie-logique>Topologie logique</h4> <p><img alt="Topologie logique" src=../images/R%C3%A9seau%20E3.drawio.svg></p> <h3 id=etapes-de-configuration>Étapes de configuration</h3> <ol> <li><strong>Préparation du switch</strong><ol> <li>Connectez-vous au switch via le câble console</li> <li>Créez les VLANs selon les paramètres suivants :<ol> <li>VLAN 10 : « INFORMATIQUE »</li> <li>VLAN 20 : « EMPLOYES »</li> </ol> </li> <li>Configurez les ports :<ol> <li>Gi0/1 : mode trunk (vers le routeur)</li> <li>Fa0/1 : VLAN 10 (serveur DHCP)</li> <li>Fa0/2 : VLAN 20 (client)</li> </ol> </li> </ol> </li> <li><strong>Configuration du routeur</strong><ol> <li>Connectez le routeur au port Fa0/1 du switch</li> <li>Créez les sous-interfaces pour chaque VLAN :<ol> <li>G0/0.10 : <code>192.168.10.1/24</code> (passerelle VLAN 10)</li> <li>G0/0.20 : <code>192.168.20.1/24</code> (passerelle VLAN 20)</li> </ol> </li> </ol> </li> <li><strong>Modification du serveur DHCP</strong><ol> <li>Vérifiez l'adresse IP de la VM Debian :<ol> <li>Nouvelle IP : <code>192.168.10.10/24</code></li> <li>Passerelle : <code>192.168.10.1</code></li> </ol> </li> <li>Vérifiez la configuration DHCP pour le VLAN 10 :<ol> <li>Plage : <code>192.168.10.50</code> à <code>192.168.10.100</code></li> <li>Passerelle : <code>192.168.10.1</code></li> <li>DNS : <code>8.8.8.8</code></li> </ol> </li> <li>Ajouter la configuration DHCP pour le VLAN 20 :<ol> <li>Plage : <code>192.168.20.50</code> à <code>192.168.20.100</code></li> <li>Passerelle : <code>192.168.20.1</code></li> <li>DNS : <code>8.8.8.8</code></li> </ol> </li> </ol> </li> </ol> <h3 id=tests-de-validation-etape-par-etape>Tests de validation étape par étape</h3> <ol> <li> <p><strong>Vérification des VLANs</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a># Sur le switch
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>show vlan brief
</code></pre></div> <p>➜ Vérifiez que :</p> <ol> <li>Les VLANs 10 et 20 sont créés<ol> <li>Fa0/1 est bien dans VLAN 10</li> <li>Fa0/2 est bien dans VLAN 20</li> </ol> </li> <li><strong>Vérification du trunk</strong></li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a># Sur le switch
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>show interfaces trunk
</code></pre></div> <p>➜ Le port Gi0/1 doit apparaître comme trunk</p> </li> <li> <p><strong>Test des sous-interfaces du routeur</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a># Sur le routeur
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>show ip interface brief
</code></pre></div> <p>➜ Vérifiez que :</p> <ol> <li>G0/0.10 est "up/up" avec IP 192.168.10.1</li> <li>G0/0.20 est "up/up" avec IP 192.168.20.1</li> </ol> </li> <li> <p><strong>Test depuis le serveur DHCP</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a># Sur la VM Debian
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>ip a                    # Vérifier la nouvelle IP
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>ping 192.168.10.1       # Tester la connectivité avec la passerelle
</code></pre></div> <p>➜ Les pings vers la passerelle doivent fonctionner</p> </li> <li> <p><strong>Test depuis le client</strong> Pour ce test initial, configurez une IP statique sur le client :</p> <ol> <li>IP : <code>192.168.20.100</code></li> <li>Masque : <code>255.255.255.0</code></li> <li>Passerelle : <code>192.168.20.1</code></li> </ol> <p>Puis testez :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>ping 192.168.20.1       # Passerelle VLAN 20
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>ping 192.168.10.1       # Passerelle VLAN 10
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>ping 192.168.10.10      # Serveur DHCP
</code></pre></div> <p>➜ Tous les pings doivent fonctionner</p> </li> </ol> <h3 id=resolution-des-problemes-courants_1>Résolution des problèmes courants</h3> <ul> <li>Si les pings entre VLANs ne fonctionnent pas :<ul> <li>Vérifiez que <code>ip routing</code> est activé sur le routeur</li> <li>Contrôlez l'encapsulation dot1Q sur les sous-interfaces</li> <li>Assurez-vous que les VLANs sont bien créés sur le switch</li> </ul> </li> <li>Si le serveur DHCP n'est plus accessible :<ul> <li>Vérifiez que son adresse IP a bien été changée pour <code>192.168.10.10</code></li> <li>Contrôlez que le port du switch est dans le bon VLAN</li> <li>Testez la connectivité avec la passerelle</li> </ul> </li> </ul> <p>À ce stade, nous avons :</p> <ul> <li>Deux réseaux logiquement séparés</li> <li>Un routage fonctionnel entre les VLANs</li> <li>Mais le DHCP ne fonctionne que dans le VLAN 10</li> </ul> <p>La prochaine étape sera de permettre aux clients du VLAN 20 d'obtenir automatiquement leurs paramètres réseau via le relais DHCP.</p> <h2 id=phase-3-mise-en-place-du-relais-dhcp>Phase 3 : Mise en place du relais DHCP</h2> <p>À ce stade, notre réseau est segmenté en deux VLANs distincts, mais nous faisons face à un défi intéressant : comment permettre aux postes du VLAN 20 d'obtenir automatiquement leurs configurations réseau alors que le serveur DHCP se trouve dans le VLAN 10 ?</p> <p>Pour comprendre l'importance du relais DHCP, imaginons une situation réelle : vous avez deux bureaux séparés par un couloir. Le serveur DHCP est dans le bureau des informaticiens (VLAN 10), mais les employés dans l'autre bureau (VLAN 20) ont aussi besoin d'obtenir leurs configurations réseau. Le relais DHCP agit comme un messager qui va transmettre les demandes d'un bureau à l'autre.</p> <h3 id=configuration-du-relais-dhcp>Configuration du relais DHCP</h3> <ol> <li><strong>Configuration du routeur comme relais</strong><ol> <li>Connectez-vous au routeur via le câble console</li> <li>Sur l'interface du VLAN 20, configurer le relais DHCP (<code>ip helper-address</code>)</li> </ol> </li> <li> <p><strong>Adaptation du serveur DHCP pour le VLAN 20</strong></p> <ol> <li>Sur la VM Debian, modifiez le fichier /etc/dhcp/dhcpd.conf</li> <li>Ajoutez une nouvelle déclaration de sous-réseau pour le VLAN 20</li> <li>Redémarrez le service DHCP :</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>sudo systemctl restart isc-dhcp-server
</code></pre></div> </li> </ol> <h3 id=tests-approfondis>Tests approfondis</h3> <ol> <li><strong>Vérification de la configuration du relais</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a># Sur le routeur
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>show running-config interface g0/0.20
</code></pre></div></li> </ol> <p>➜ Vérifiez que la commande <code>ip helper-address 192.168.10.10</code> apparaît</p> <ol> <li><strong>Observation du processus DHCP en temps réel</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a># Sur le routeur
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>debug ip dhcp server packet
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>debug ip dhcp relay
</code></pre></div></li> </ol> <p>Ces commandes vous permettront d'observer les échanges DHCP en direct.</p> <ol> <li> <p><strong>Test sur le PC client</strong></p> <ol> <li>Configurez l'interface réseau en DHCP automatique</li> <li>Sur Windows :</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>ipconfig /release
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>ipconfig /renew
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>ipconfig /all
</code></pre></div> </li> <li> <p>Sur Linux : <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>sudo dhclient -r
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>sudo dhclient
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>ip a
</code></pre></div></p> <p>➜ Vérifiez que :</p> <ol> <li>L'adresse IP obtenue est dans la plage <code>192.168.20.100-200</code><ol> <li>La passerelle est <code>192.168.20.1</code></li> <li>Le serveur DNS est <code>8.8.8.8</code></li> </ol> </li> <li><strong>Tests de connectivité complète</strong> Depuis le PC client :</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>ping 192.168.20.1       # Passerelle locale
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>ping 192.168.10.1       # Passerelle distante
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>ping 192.168.10.10      # Serveur DHCP
</code></pre></div> </li> </ol> <p>Tous ces pings doivent fonctionner.</p> <ol> <li> <p><strong>Vérification des baux DHCP</strong> Sur le serveur Debian :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>cat /var/lib/dhcp/dhcpd.leases
</code></pre></div> <p>➜ Vous devriez voir des baux pour des adresses dans les deux plages (VLAN 10 et 20)</p> </li> </ol> <h3 id=comprendre-ce-qui-se-passe>Comprendre ce qui se passe</h3> <p>Quand un client du VLAN 20 demande une adresse IP :</p> <ol> <li>Il envoie une requête DHCP en broadcast</li> <li>Le routeur reçoit cette requête sur G0/0.20</li> <li>Grâce à <code>ip helper-address</code>, il la transmet en unicast au serveur DHCP</li> <li>Le serveur répond avec les paramètres du VLAN 20</li> <li>Le routeur retransmet la réponse au client</li> </ol> <h3 id=resolution-des-problemes-courants_2>Résolution des problèmes courants</h3> <p>Si le client n'obtient pas d'adresse :</p> <ol> <li> <p>Vérifiez les logs sur le serveur DHCP : <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>tail -f /var/log/syslog | grep dhcp
</code></pre></div></p> </li> <li> <p>Sur le routeur, confirmez que les requêtes sont relayées : <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>show ip dhcp relay statistics
</code></pre></div></p> </li> <li> <p>Points à vérifier :</p> <ol> <li>La déclaration du sous-réseau 192.168.20.0 dans dhcpd.conf</li> <li>La configuration du relais sur la bonne sous-interface</li> <li>L'accessibilité du serveur DHCP depuis le routeur</li> </ol> </li> </ol> <p>Cette configuration complète permet maintenant à tous les clients, quel que soit leur VLAN, d'obtenir automatiquement leur configuration réseau de manière sécurisée et organisée.</p> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Retour en haut de la page </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label="Pied de page"> <a href=../../.. class="md-footer__link md-footer__link--prev" aria-label="Précédent: Accueil"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Précédent </span> <div class=md-ellipsis> Accueil </div> </div> </a> <a href=../../../about/ class="md-footer__link md-footer__link--next" aria-label="Suivant: À propos"> <div class=md-footer__title> <span class=md-footer__direction> Suivant </span> <div class=md-ellipsis> À propos </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.footer", "content.action.edit", "toc.integrate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script> <script src=../../../assets/javascripts/bundle.cd18aaf1.min.js></script> <script src=../../../assets/extra.38b060.min.js></script> </body> </html>